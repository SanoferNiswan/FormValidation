<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration Form with Validation</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      max-width: 600px;
    }
    .form-section {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .form-label {
      font-weight: bold;
    }
    .error {
      color: red;
      font-size: 0.875em;
    }
    .profile {
      width: 95%;
      height: 95%;
      border-radius: 50%;
    }
    .name {
      letter-spacing: 1px;
      font-size: 20px;
    }
    .user-info-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .btn-primary {
      background-color: #007bff;
      border: none;
    }
    .btn-primary:hover {
      background-color: #0056b3;
    }
    .btn-outline-success {
      border-color: #28a745;
      color: #28a745;
    }
    .btn-outline-success:hover {
      background-color: #28a745;
      color: #fff;
    }
    #search-results {
      margin-top: 20px;
    }
    .user-card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .user-card img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 50%;
    }
    .user-card h5 {
      margin-top: 10px;
      font-weight: bold;
    }
    .user-card p {
      margin-bottom: 5px;
    }
    .user-card .btn {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <div>
    <div class="form-section">
      <h2 class="mb-4 text-center">Registration Form</h2>
      <form id="registrationForm" enctype="multipart/form-data" novalidate>
        <!-- Name -->
        <div class="mb-3">
          <label for="name" class="form-label">Name<span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="name" required>
          <div class="error" id="nameError"></div>
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label for="email" class="form-label">Email<span class="text-danger">*</span></label>
          <input type="email" class="form-control" id="email" required>
          <div class="error" id="emailError"></div>
        </div>

        <!-- Contact -->
        <div class="mb-3">
          <label for="contact" class="form-label">Contact Number<span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="contact" required>
          <div class="error" id="contactError"></div>
        </div>

        <!-- DOB -->
        <div class="mb-3">
          <label for="dob" class="form-label">Date of Birth<span class="text-danger">*</span></label>
          <input type="date" class="form-control" id="dob" required>
          <div class="error" id="dobError"></div>
        </div>

        <!-- Gender -->
        <div class="mb-3">
          <label for="gender" class="form-label">Gender<span class="text-danger">*</span></label>
          <select class="form-select" id="gender" required>
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
          <div class="error" id="genderError"></div>
        </div>

        <!-- Education -->
        <div class="mb-3">
          <label for="education" class="form-label">Education<span class="text-danger">*</span></label>
          <select class="form-select" id="education" required>
            <option value="">Select Education</option>
            <option value="B.E">B.E</option>
            <option value="B.Tech">B.Tech</option>
            <option value="M.E">M.E</option>
            <option value="M.Tech">M.Tech</option>
            <option value="MCA">MCA</option>
            <option value="M.Sc">M.Sc</option>
            <option value="B.Sc">B.Sc</option>
            <option value="B.Pharm">B.Pharm</option>
            <option value="B.Arch">B.Arch</option>
            <option value="MBBS">MBBS</option>
            <option value="BDS">BDS</option>
            <option value="BA">BA</option>
          </select>
          <div class="error" id="educationError"></div>
        </div>

        <!-- Occupation -->
        <div class="mb-3">
          <label for="occupation" class="form-label">Occupation (Optional)</label>
          <input type="text" class="form-control" id="occupation">
          <div class="error" id="occupationError"></div>
        </div>

        <!-- Username -->
        <div class="mb-3">
          <label for="username" class="form-label">Username<span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="username" required>
          <div class="error" id="usernameError"></div>
        </div>

        <!-- Password -->
        <div class="mb-3">
          <label for="password" class="form-label">Password<span class="text-danger">*</span></label>
          <input type="password" class="form-control" id="password" required>
          <div class="error" id="passwordError"></div>
        </div>

        <!-- PAN -->
        <div class="mb-3">
          <label for="pan" class="form-label">PAN<span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="pan" required>
          <div class="error" id="panError"></div>
        </div>

        <!-- Profile Picture -->
        <div class="mb-3">
          <label for="profilePic" class="form-label">Profile Picture<span class="text-danger">*</span></label>
          <input type="file" class="form-control" id="profilePic" accept=".png, .jpeg, .jpg" required>
          <div class="error" id="profilePicError"></div>
        </div>
        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-100">Submit</button>
      </form>
    </div>

    <!-- Placeholder for Search UI -->
    <div class="mt-5">
      <h3 class="mb-3">Search Users</h3>
      <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
         <form class="d-flex">
          <input class="form-control me-2" id="user-search" type="search" placeholder="Search by name, image size(kb) or days" aria-label="Search">
          <button class="btn btn-outline-success" id="search-btn" type="button">Search</button>
         </form>
        </div>
      </nav>
    </div>

    <!-- Placeholder for Search Results -->
    <div id="search-results" class="mt-3 user-info-container"></div>
  </div>
  </div>
 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('registrationForm');
      function userSearch() {
      const prompt = document.getElementById("user-search").value.trim();
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const searchResultContainer = document.getElementById("search-results");
      searchResultContainer.innerHTML = ''; // Clear previous results

  if (!prompt) {
    return; // Exit if the search is empty
  }

  let filteredUsers = [];

  if (prompt.replace(/[a-zA-Z]/g, "").length === 0) {
    // Name search
    filteredUsers = users.filter(user => user.name.toLowerCase().includes(prompt.toLowerCase()));
  } 
  else if (prompt.replace(/[0-9]/g, '').length === 0) {
    // Search by days since birth if input contains only numbers
    const daysValue = parseInt(prompt); // Directly parse the number from the prompt
    if (!isNaN(daysValue)) { // Validate that it is a number
        filteredUsers = users.filter(user => {
            const daysSinceDOB = calculateDays(new Date(user.dob));
            return daysSinceDOB === daysValue; // Filter users whose days since DOB is <= the input
        });
    }
}

   else if (prompt.toLowerCase().includes("kb")) {    
    const sizeInMB = parseInt(prompt.replace(/[^0-9]/g, '')); 
    if (!isNaN(sizeInMB)) {
      filteredUsers = users.filter(user => {
        const imageSizeInMB = user.profilePic.size/1024; 
        return imageSizeInMB <= sizeInMB;
      });
    }
  }

  if (filteredUsers.length > 0) {
    displayResults(filteredUsers);
  } else {
    searchResultContainer.innerHTML = '<p>No results found</p>';
  }

}
      // document.getElementById("user-search").addEventListener('input', userSearch);
      form.querySelectorAll('input').forEach(field => {        
      field.addEventListener('input', validateForm);
      });

// form.querySelectorAll('select').forEach(field => {
//         field.addEventListener('input', validateForm);
//        });

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        clearErrors();
        const isValid = validateForm();
        if (isValid) {
          storeData();
          form.reset();
          alert('Form submitted successfully!');
        }

      });
      function clearErrors() {
        const errorElements = document.querySelectorAll('.error');
        errorElements.forEach(el => el.textContent = '');
      }

      function validateForm() {
        // localStorage.clear();
        clearErrors();
        let valid = true;
        const name = document.getElementById('name').value.trim();

        if (name === '') {
          showError('nameError', 'Name is required.');
          valid = false;
        }

        const email = document.getElementById('email').value.trim();
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (email === '') {
          showError('emailError', 'Email is required.');
          valid = false;
        } else if (!emailPattern.test(email)) {
          showError('emailError', 'Invalid email format.');
          valid = false;
        }

        const contact = document.getElementById('contact').value.trim();
        const contactPattern = /^[9876]\d{9}$/;
        if (contact === '') {
          showError('contactError', 'Contact number is required.');
          valid = false;

        } else if (!contactPattern.test(contact)) {
          showError('contactError', 'Contact must start with 9,8,7,6 and be 10 digits.');
          valid = false;
        }
        const dob = document.getElementById('dob').value;

        if (dob === '') {
          showError('dobError', 'Date of Birth is required.');
          valid = false;
        } else {
          const year = new Date(dob).getFullYear();
          if (year < 1950 || year > 2010) {
            showError('dobError', 'DOB must be between 1950 and 2010.');
            valid = false;
          }
        }
        const gender = document.getElementById('gender').value;
        if (gender === '') {
          showError('genderError', 'Please select a gender.');
          valid = false;
        }
        const education = document.getElementById('education').value;

        if (education === '') {
          showError('educationError', 'Please select an education.');
          valid = false;
        }
        const username = document.getElementById('username').value.trim();

        if (username === '') {
          showError('usernameError', 'Username is required.');
          valid = false;
        } else if (isUsernameTaken(username)) {
          showError('usernameError', 'Username is already taken.');
          valid = false;
        }

        const password = document.getElementById('password').value;
        const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,15}$/;
        if (password === '') {
          showError('passwordError', 'Password is required.');
          valid = false;
        } else if (!passwordPattern.test(password)) {
          showError('passwordError', 'Password must be 8-15 characters, include uppercase, lowercase, number, and special character.');
          valid = false;
        }
        const pan = document.getElementById('pan').value.trim();
        const panPattern = /^[A-Z]{5}\d{4}[A-Z]{1}$/;

        if (pan === '') {
          showError('panError', 'PAN is required.');
          valid = false;
        } else if (!panPattern.test(pan)) {
          showError('panError', 'Invalid PAN format.');
          valid = false;
        }
        const profilePic = document.getElementById('profilePic').files[0];
        if (!profilePic) {
          showError('profilePicError', 'Profile picture is required.');
          valid = false;
        } else {
          const allowedTypes = ['image/png', 'image/jpeg'];
          if (!allowedTypes.includes(profilePic.type)) {
            showError('profilePicError', 'Only PNG and JPEG formats are allowed.');
            valid = false;
          }
          if (profilePic.size > 2 * 1024 * 1024) { 
            showError('profilePicError', 'File size must be less than 2MB.');
            valid = false;
          }
        }
        return valid;
      }

      function showError(elementId, message) {
        document.getElementById(elementId).textContent = message;
      }

      function isUsernameTaken(username) {
        const users = JSON.parse(localStorage.getItem('users')) || [];
        return users.some(user => user.username.toLowerCase() === username.toLowerCase());
      }

      function storeData() {

        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const contact = document.getElementById('contact').value.trim();
        const dob = document.getElementById('dob').value;
        const gender = document.getElementById('gender').value;
        const education = document.getElementById('education').value;
        const occupation = document.getElementById('occupation').value.trim();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const pan = document.getElementById('pan').value.trim();
        const profilePic = document.getElementById('profilePic').files[0];

        const reader = new FileReader();
        reader.onload = function () {
            const profilePicData = {
            filename: profilePic.name,
            type: profilePic.type,
            size: profilePic.size,
            data: reader.result
          };

          const user = {
            name,
            email,
            contact,
            dob,
            gender,
            education,
            occupation: occupation || null,
            username,
            password,
            pan,
            profilePic: profilePicData
          };

          const users = JSON.parse(localStorage.getItem('users')) || [];
          users.push(user);
          localStorage.setItem('users', JSON.stringify(users));

        };

        reader.readAsDataURL(profilePic);

      }
    document.getElementById("user-search").addEventListener('input', userSearch);
    document.getElementById("search-btn").addEventListener('click', userSearch);

    function displayResults(users) {
    const searchResultContainer = document.getElementById("search-results");
    if (users.length === 0) {
      searchResultContainer.innerHTML = '<p>No results found</p>';
      return;
    }

    let searchResult = '';
    users.forEach(user => {

      const age = calculateAge(new Date(user.dob));
      searchResult += `<section class="vh-100" style="background-color: #f0f2f5;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-12 col-xl-6">
                <div class="card" style="border-radius: 15px;">
                    <div class="card-body text-center">

                        <div class="mt-3 mb-4">
                            <img id="profilePic" src="${user.profilePic.data}" alt="${user.name}" 
                                 class="rounded-circle img-fluid" style="width: 100px;" />
                        </div>

                        <h4 class="mb-2" id="userName">${user.name}</h4>
                        <p class="text-muted mb-4" id="userOccupation">
                            ${user.email}
                        
                        <table class="table mt-4 text-start">
                            <tbody>
                                <tr>
                                    <th scope="row">Phone</th>
                                    <td id="userPhone">${user.contact}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Date of Birth</th>
                                    <td id="userDOB">${user.dob}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Gender</th>
                                    <td id="userGender">${user.gender}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Education</th>
                                    <td id="userEducation">${user.education}</td>
                                </tr>
                                <tr>
                                    <th scope="row">PAN</th>
                                    <td id="userPan">${user.pan}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Days Count</th>
                                    <td>${calculateDays(new Date(user.dob))}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Occupation</th>
                                  <td>${user.occupation || "not available"} </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
`;
    });
    searchResultContainer.innerHTML = searchResult;
  }

  function calculateAge(dob) {
    const diffMs = Date.now() - dob.getTime();
    const ageDt = new Date(diffMs);
    return Math.abs(ageDt.getUTCFullYear() - 1970);
  }

  function calculateDays(dob) {
    const oneDay = 24 * 60 * 60 * 1000; // hours * minutes * seconds * milliseconds
    const diffDays = Math.round(Math.abs((Date.now() - dob.getTime()) / oneDay));
    return diffDays;
  }

});
  </script>
</body>

</html>